<div class="page-container">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="login-container">
                    <div class="login-header">
                        <h2>Login with OTP</h2>
                        <p class="text-muted">Enter your Indian mobile number to receive OTP</p>
                    </div>
                    <div class="success-alert alert alert-success" role="alert">
                        <i class="bi bi-check-circle-fill"></i> Login successful! Redirecting...
                    </div>
                    <form id="loginForm">
                        <div class="mb-3 flag-container">
                            <input class="form-control" id="loginMobileNumber" autofocus>
                            <div class="invalid-feedback">Please enter a valid 10-digit Indian mobile number</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mb-3" ng-click="generateOTP()">
                            Send OTP
                        </button>
                    </form>
                    <div class="mt-3 text-center">
                        <p class="text-muted">By continuing, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Message Modal -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-otp modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messageModalLabel">{{message.header}}</h5>
            </div>
            <div class="modal-body text-center">
                <div class="text-center mb-4">
                    <i class="bi bi-shield-check success-check"></i>
                    <p class="text-muted">{{message.content}}</p>
                </div>
                <button class="btn btn-primary" ng-click="gotoOnboarding()">Goto Onboarding</button>
            </div>
        </div>
    </div>
</div>
<!-- OTP Modal -->
<div class="modal fade" id="otpModal" aria-labelledby="otpModalLabel" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-otp modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="otpModalLabel">Verification Required</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="bi bi-shield-check success-check"></i>
                    <h4>Enter Verification Code</h4>
                    <p class="text-muted">We've sent a 6-digit code to your Mobile Number</p>
                </div>
                <form id="otpForm">
                    <div class="otp-container">
                        <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code" required ng-model="otp1">
                        <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" required ng-model="otp2">
                        <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" required ng-model="otp3">
                        <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" required ng-model="otp4">
                        <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" required ng-model="otp5">
                        <input type="text" class="otp-input" maxlength="1" inputmode="numeric" pattern="[0-9]*" required ng-model="otp6">
                    </div>
                    <button type="submit" class="btn btn-primary verify-btn w-100" ng-click="validateOTP(otp1,otp2,otp3,otp4,otp5,otp6)">
                        <i class="bi bi-check-circle me-2"></i>Verify & Continue
                    </button>
                    <br>
                    <button type="submit" class="btn btn-primary verify-btn w-100" ng-click="otpModal.hide()" style="margin-top: 20px;">
                        Cancel
                    </button>
                </form>
                <div class="resend-text">
                    <p>Didn't receive the code? <a href="#" id="resendLink">Resend</a> <span id="countdown" class="countdown">(60s)</span></p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Success Toast (hidden by default) -->
<div class="toast align-items-center text-white bg-success position-fixed top-50 start-50 translate-middle" role="alert" aria-live="assertive" aria-atomic="true" id="successToast">
    <div class="d-flex">
        <div class="toast-body">
            <i class="bi bi-check-circle-fill me-2"></i> Verification successful!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
</div>
<script>
$(document).ready(function() {
    // OTP Input navigation
    $('.otp-input').keyup(function(e) {
        if (this.value.length === this.maxLength) {
            $(this).addClass('filled');
            $(this).next('.otp-input').focus();
        } else if (this.value.length === 0 && e.keyCode === 8) {
            $(this).removeClass('filled');
            $(this).prev('.otp-input').focus();
        }

        // Check if all fields are filled
        checkOTPCompletion();
    });

    // Paste OTP from clipboard
    $('.otp-input').on('paste', function(e) {
        const clipboardData = e.originalEvent.clipboardData || window.clipboardData;
        const pastedData = clipboardData.getData('text');

        if (/^\d{6}$/.test(pastedData)) {
            e.preventDefault();
            const inputs = $('.otp-input');
            for (let i = 0; i < 6; i++) {
                $(inputs[i]).val(pastedData[i]).addClass('filled');
            }
            inputs.last().focus();
            checkOTPCompletion();
        }
    });

    // Form submission
    $('#otpForm').on('submit', function(e) {
        e.preventDefault();

        // Get OTP value
        let otp = '';
        $('.otp-input').each(function() {
            otp += $(this).val();
        });

        // Validate OTP (simple demo validation)
        if (otp === '123456') { // Demo code
            // Show success toast
            const toast = new bootstrap.Toast(document.getElementById('successToast'));
            toast.show();

            // Close modal after 2 seconds
            setTimeout(function() {
                $('#otpModal').modal('hide');
            }, 2000);
        } else {
            // Shake effect for wrong OTP
            $('.otp-container').addClass('animate__animated animate__headShake');
            setTimeout(function() {
                $('.otp-container').removeClass('animate__animated animate__headShake');
            }, 1000);

            // Clear inputs
            $('.otp-input').val('').removeClass('filled').first().focus();
        }
    });

    // Resend OTP countdown
    let timeLeft = 60;
    const countdownElement = $('#countdown');
    const resendLink = $('#resendLink');

    resendLink.hide();

    const downloadTimer = setInterval(function() {
        if (timeLeft <= 0) {
            clearInterval(downloadTimer);
            countdownElement.hide();
            resendLink.show();
        } else {
            countdownElement.text('(' + timeLeft + 's)');
        }
        timeLeft -= 1;
    }, 1000);

    // Resend OTP functionality
    resendLink.on('click', function(e) {
        e.preventDefault();
        timeLeft = 60;
        resendLink.hide();
        countdownElement.show();

        // Restart the timer
        const newTimer = setInterval(function() {
            if (timeLeft <= 0) {
                clearInterval(newTimer);
                countdownElement.hide();
                resendLink.show();
            } else {
                countdownElement.text('(' + timeLeft + 's)');
            }
            timeLeft -= 1;
        }, 1000);

        // Show message (in a real app, this would resend the OTP)
        alert('A new OTP has been sent to your email.');
    });

    // Focus first input when modal is shown
    $('#otpModal').on('shown.bs.modal', function() {
        $('.otp-input').first().focus();
    });

    // Clear inputs when modal is hidden
    $('#otpModal').on('hidden.bs.modal', function() {
        $('.otp-input').val('').removeClass('filled');
    });

    // Check if all OTP fields are filled
    function checkOTPCompletion() {
        let allFilled = true;
        $('.otp-input').each(function() {
            if ($(this).val() === '') {
                allFilled = false;
                return false;
            }
        });

        if (allFilled) {
            $('#otpForm button[type="submit"]').focus();
        }
    }
});
</script>