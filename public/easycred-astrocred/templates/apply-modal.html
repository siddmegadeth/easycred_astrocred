<!-- Modal -->
<div class="modal fade" id="autoLoanModal" tabindex="-1" aria-labelledby="autoLoanModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="autoLoanModalLabel">Document Upload</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted mb-4">Please provide your information and upload the required documents</p>
                <!-- Step Progress -->
                <div class="step-progress mb-4">
                    <div class="step active" id="step1">
                        1
                        <div class="step-label">Employment</div>
                    </div>
                    <div class="step" id="step2">
                        2
                        <div class="step-label">Personal</div>
                    </div>
                    <div class="step" id="step3">
                        3
                        <div class="step-label">Address</div>
                    </div>
                    <div class="step" id="step4">
                        4
                        <div class="step-label">Documents</div>
                    </div>
                    <div class="step" id="step5">
                        5
                        <div class="step-label">Review</div>
                    </div>
                </div>
                <!-- Step 1: Employment Type -->
                <div class="step-content active" id="stepContent1">
                    <h4 class="form-title">Employment Type</h4>
                    <p class="text-muted mb-4">Please select your employment type</p>
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="card employment-type h-100 text-center p-3" data-type="salaried">
                                <i class="fas fa-briefcase"></i>
                                <h5>Salaried</h5>
                                <p class="text-muted small">Regular monthly income from employer</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card employment-type h-100 text-center p-3" data-type="selfEmployed">
                                <i class="fas fa-user-tie"></i>
                                <h5>Self Employed</h5>
                                <p class="text-muted small">Professional or freelancer with own business</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card employment-type h-100 text-center p-3" data-type="business">
                                <i class="fas fa-building"></i>
                                <h5>Business Owner</h5>
                                <p class="text-muted small">Own a registered business entity</p>
                            </div>
                        </div>
                    </div>
                    <!-- Conditional Fields -->
                    <div class="conditional-field" id="salariedFields">
                        <h5 class="mb-3">Salaried Information</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="companyName" class="form-label required-field">Company Name</label>
                                <input type="text" class="form-control" id="companyName">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="monthlySalary" class="form-label required-field">Monthly Salary (â‚¹)</label>
                                <input type="number" class="form-control" id="monthlySalary">
                            </div>
                        </div>
                    </div>
                    <div class="conditional-field" id="selfEmployedFields">
                        <h5 class="mb-3">Self Employed Information</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="profession" class="form-label required-field">Profession</label>
                                <input type="text" class="form-control" id="profession">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gstSelf" class="form-label required-field">GST Number</label>
                                <input type="text" class="form-control" id="gstSelf">
                            </div>
                        </div>
                    </div>
                    <div class="conditional-field" id="businessFields">
                        <h5 class="mb-3">Business Information</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="businessName" class="form-label required-field">Business Name</label>
                                <input type="text" class="form-control" id="businessName">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="businessType" class="form-label required-field">Business Type</label>
                                <select class="form-select" id="businessType">
                                    <option value="">Select...</option>
                                    <option value="proprietorship">Proprietorship</option>
                                    <option value="partnership">Partnership</option>
                                    <option value="llp">LLP</option>
                                    <option value="pvt-ltd">Private Limited</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gstBusiness" class="form-label required-field">GST Number</label>
                                <input type="text" class="form-control" id="gstBusiness">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="companyPan" class="form-label required-field">Company PAN</label>
                                <input type="text" class="form-control" id="companyPan">
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end mt-4">
                        <button type="button" class="btn btn-easycred" onclick="showStep(2)">Next <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                <!-- Step 2: Personal Information -->
                <div class="step-content" id="stepContent2">
                    <h4 class="form-title">Personal Information</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fullName" class="form-label required-field">Full Name</label>
                            <input type="text" class="form-control" id="fullName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="dob" class="form-label required-field">Date of Birth</label>
                            <input type="date" class="form-control" id="dob" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fatherName" class="form-label required-field">Father's Name</label>
                            <input type="text" class="form-control" id="fatherName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="motherName" class="form-label required-field">Mother's Name</label>
                            <input type="text" class="form-control" id="motherName" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="panNumber" class="form-label required-field">PAN Number</label>
                            <input type="text" class="form-control" id="panNumber" required>
                            <div class="upload-instruction">Please have your PAN card ready for upload</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="aadharNumber" class="form-label required-field">Aadhar Number</label>
                            <input type="text" class="form-control" id="aadharNumber" required>
                            <div class="upload-instruction">Please have both sides of your Aadhar card ready</div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-secondary" onclick="showStep(1)"><i class="fas fa-arrow-left me-2"></i> Previous</button>
                        <button type="button" class="btn btn-easycred" onclick="showStep(3)">Next <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                <!-- Step 3: Address Details -->
                <div class="step-content" id="stepContent3">
                    <h4 class="form-title">Address Details</h4>
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="fas fa-home me-2"></i>Current Address</h5>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="currentAddress" class="form-label required-field">Full Address</label>
                                <textarea class="form-control" id="currentAddress" rows="2" required></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="currentCity" class="form-label required-field">City</label>
                                <input type="text" class="form-control" id="currentCity" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="currentState" class="form-label required-field">State</label>
                                <input type="text" class="form-control" id="currentState" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="currentPincode" class="form-label required-field">Pincode</label>
                                <input type="text" class="form-control" id="currentPincode" required>
                            </div>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="sameAsCurrent">
                            <label class="form-check-label" for="sameAsCurrent">
                                Permanent address is same as current address
                            </label>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="fas fa-building me-2"></i>Permanent Address</h5>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="permanentAddress" class="form-label required-field">Full Address</label>
                                <textarea class="form-control" id="permanentAddress" rows="2" required></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="permanentCity" class="form-label required-field">City</label>
                                <input type="text" class="form-control" id="permanentCity" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="permanentState" class="form-label required-field">State</label>
                                <input type="text" class="form-control" id="permanentState" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="permanentPincode" class="form-label required-field">Pincode</label>
                                <input type="text" class="form-control" id="permanentPincode" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="fas fa-briefcase me-2"></i>Office Address</h5>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="officeAddress" class="form-label">Full Address (if applicable)</label>
                                <textarea class="form-control" id="officeAddress" rows="2"></textarea>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="officeCity" class="form-label">City</label>
                                <input type="text" class="form-control" id="officeCity">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="officeState" class="form-label">State</label>
                                <input type="text" class="form-control" id="officeState">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="officePincode" class="form-label">Pincode</label>
                                <input type="text" class="form-control" id="officePincode">
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-secondary" onclick="showStep(2)"><i class="fas fa-arrow-left me-2"></i> Previous</button>
                        <button type="button" class="btn btn-easycred" onclick="showStep(4)">Next <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                <!-- Step 4: Document Upload -->
                <div class="step-content" id="stepContent4">
                    <h4 class="form-title">Document Upload</h4>
                    <p class="text-muted mb-4">Please upload the following documents in PDF format only</p>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 required-field">PAN Card</h6>
                                <p class="mb-0 upload-instruction">Upload a clear scan of your PAN card (PDF only, max 5MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond pan-card" name="panCard" accept=".pdf" data-max-file-size="5MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 required-field">Aadhar Card (Front & Back)</h6>
                                <p class="mb-0 upload-instruction">Upload both sides of your Aadhar card as a single PDF (max 5MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond aadhar-card" name="aadharCard" accept=".pdf" data-max-file-size="5MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 required-field">Income Tax Return</h6>
                                <p class="mb-0 upload-instruction">Upload your latest Income Tax Return (PDF only, max 10MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond itr" name="itr" accept=".pdf" data-max-file-size="10MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Form 16</h6>
                                <p class="mb-0 upload-instruction">Upload your Form 16 if applicable (PDF only, max 10MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond form16" name="form16" accept=".pdf" data-max-file-size="10MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Form 26AS</h6>
                                <p class="mb-0 upload-instruction">Upload your Form 26AS (PDF only, max 10MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond form26as" name="form26as" accept=".pdf" data-max-file-size="10MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 required-field">Bank Statements</h6>
                                <p class="mb-0 upload-instruction">Upload your last 6 months bank statements (PDF only, max 10MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond bank-statement" name="bankStatement" accept=".pdf" data-max-file-size="10MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Salary Slips</h6>
                                <p class="mb-0 upload-instruction">Upload your last 3 months salary slips (PDF only, max 5MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond salary-slips" name="salarySlips" accept=".pdf" data-max-file-size="5MB">
                    </div>
                    <div class="document-card">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Offer Letter</h6>
                                <p class="mb-0 upload-instruction">Upload your offer letter if needed (PDF only, max 5MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond offer-letter" name="offerLetter" accept=".pdf" data-max-file-size="5MB">
                    </div>
                    <!-- Conditional GST Documents -->
                    <div class="document-card conditional-field" id="gstDocument">
                        <div class="d-flex align-items-center">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">GST Certificate</h6>
                                <p class="mb-0 upload-instruction">Upload your GST certificate (PDF only, max 5MB)</p>
                            </div>
                        </div>
                        <input type="file" class="filepond gst-certificate" name="gstCertificate" accept=".pdf" data-max-file-size="5MB">
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-secondary" onclick="showStep(3)"><i class="fas fa-arrow-left me-2"></i> Previous</button>
                        <button type="button" class="btn btn-easycred" onclick="showStep(5)">Next <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                <!-- Step 5: Review & Submit -->
                <div class="step-content" id="stepContent5">
                    <h4 class="form-title">Review & Submit</h4>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> Please review all the information you've provided before submitting.
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="mb-3">Personal Information</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th width="40%">Full Name</th>
                                    <td id="reviewFullName"></td>
                                </tr>
                                <tr>
                                    <th>Date of Birth</th>
                                    <td id="reviewDOB"></td>
                                </tr>
                                <tr>
                                    <th>Father's Name</th>
                                    <td id="reviewFatherName"></td>
                                </tr>
                                <tr>
                                    <th>Mother's Name</th>
                                    <td id="reviewMotherName"></td>
                                </tr>
                                <tr>
                                    <th>PAN Number</th>
                                    <td id="reviewPAN"></td>
                                </tr>
                                <tr>
                                    <th>Aadhar Number</th>
                                    <td id="reviewAadhar"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5 class="mb-3">Employment Details</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th width="40%">Employment Type</th>
                                    <td id="reviewEmploymentType"></td>
                                </tr>
                                <tr id="reviewCompanyRow">
                                    <th>Company Name</th>
                                    <td id="reviewCompanyName"></td>
                                </tr>
                                <tr id="reviewSalaryRow">
                                    <th>Monthly Salary</th>
                                    <td id="reviewMonthlySalary"></td>
                                </tr>
                                <tr id="reviewGSTRow">
                                    <th>GST Number</th>
                                    <td id="reviewGSTNumber"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">Address Details</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th width="20%">Current Address</th>
                                    <td id="reviewCurrentAddress"></td>
                                </tr>
                                <tr>
                                    <th>Permanent Address</th>
                                    <td id="reviewPermanentAddress"></td>
                                </tr>
                                <tr>
                                    <th>Office Address</th>
                                    <td id="reviewOfficeAddress"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <h5 class="mb-3">Uploaded Documents</h5>
                    <ul class="list-group mb-4" id="reviewDocuments">
                        <li class="list-group-item">No documents uploaded yet</li>
                    </ul>
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="termsAgree" required>
                        <label class="form-check-label" for="termsAgree">
                            I hereby declare that all the information provided is true to the best of my knowledge and all documents uploaded are genuine.
                        </label>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary" onclick="showStep(4)"><i class="fas fa-arrow-left me-2"></i> Previous</button>
                        <button type="button" class="btn btn-easycred" onclick="submitForm()">Submit Application</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
// Initialize FilePond
FilePond.registerPlugin(FilePondPluginFileValidateType);

// Get all file input elements
const inputElements = document.querySelectorAll('input.filepond');

// Create FilePond instances for each input
inputElements.forEach(input => {
    FilePond.create(input, {
        acceptedFileTypes: ['application/pdf'],
        labelFileTypeNotAllowed: 'Only PDF files are allowed',
        fileValidateTypeLabelExpectedTypes: 'Expects PDF',
        storeAsFile: true,
        maxFiles: 1,
        allowMultiple: false
    });
});

// Initialize EmailJS (replace with your actual User ID)
emailjs.init("YOUR_EMAILJS_USER_ID");

// Employment type selection
const employmentTypes = document.querySelectorAll('.employment-type');
let selectedEmploymentType = '';

employmentTypes.forEach(type => {
    type.addEventListener('click', function() {
        employmentTypes.forEach(t => t.classList.remove('selected'));
        this.classList.add('selected');
        selectedEmploymentType = this.getAttribute('data-type');

        // Hide all conditional fields
        document.querySelectorAll('.conditional-field').forEach(field => {
            field.classList.remove('show');
        });

        // Show relevant fields based on selection
        if (selectedEmploymentType === 'salaried') {
            document.getElementById('salariedFields').classList.add('show');
            document.getElementById('gstDocument').classList.remove('show');
        } else if (selectedEmploymentType === 'selfEmployed') {
            document.getElementById('selfEmployedFields').classList.add('show');
            document.getElementById('gstDocument').classList.add('show');
        } else if (selectedEmploymentType === 'business') {
            document.getElementById('businessFields').classList.add('show');
            document.getElementById('gstDocument').classList.add('show');
        }
    });
});

// Stepper functionality
function showStep(stepNumber) {
    // Hide all step contents
    document.querySelectorAll('.step-content').forEach(content => {
        content.classList.remove('active');
    });

    // Show the selected step content
    document.getElementById('stepContent' + stepNumber).classList.add('active');

    // Update step progress
    document.querySelectorAll('.step').forEach((step, index) => {
        step.classList.remove('active', 'completed');
        if (index + 1 < stepNumber) {
            step.classList.add('completed');
        } else if (index + 1 === stepNumber) {
            step.classList.add('active');
        }
    });

    // If we're on the review step, populate the review data
    if (stepNumber === 5) {
        populateReviewData();
    }
}

// Populate review data
function populateReviewData() {
    // Personal Information
    document.getElementById('reviewFullName').textContent = document.getElementById('fullName').value || 'Not provided';
    document.getElementById('reviewDOB').textContent = document.getElementById('dob').value || 'Not provided';
    document.getElementById('reviewFatherName').textContent = document.getElementById('fatherName').value || 'Not provided';
    document.getElementById('reviewMotherName').textContent = document.getElementById('motherName').value || 'Not provided';
    document.getElementById('reviewPAN').textContent = document.getElementById('panNumber').value || 'Not provided';
    document.getElementById('reviewAadhar').textContent = document.getElementById('aadharNumber').value || 'Not provided';

    // Employment Information
    document.getElementById('reviewEmploymentType').textContent = selectedEmploymentType ? selectedEmploymentType.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()) : 'Not provided';

    // Hide all employment detail rows initially
    document.getElementById('reviewCompanyRow').style.display = 'none';
    document.getElementById('reviewSalaryRow').style.display = 'none';
    document.getElementById('reviewGSTRow').style.display = 'none';

    if (selectedEmploymentType === 'salaried') {
        document.getElementById('reviewCompanyRow').style.display = '';
        document.getElementById('reviewSalaryRow').style.display = '';
        document.getElementById('reviewCompanyName').textContent = document.getElementById('companyName').value || 'Not provided';
        document.getElementById('reviewMonthlySalary').textContent = document.getElementById('monthlySalary').value ? 'â‚¹' + document.getElementById('monthlySalary').value : 'Not provided';
    } else if (selectedEmploymentType === 'selfEmployed') {
        document.getElementById('reviewGSTRow').style.display = '';
        document.getElementById('reviewGSTNumber').textContent = document.getElementById('gstSelf').value || 'Not provided';
    } else if (selectedEmploymentType === 'business') {
        document.getElementById('reviewGSTRow').style.display = '';
        document.getElementById('reviewGSTNumber').textContent = document.getElementById('gstBusiness').value || 'Not provided';
    }

    // Address Information
    document.getElementById('reviewCurrentAddress').textContent = document.getElementById('currentAddress').value || 'Not provided';
    document.getElementById('reviewPermanentAddress').textContent = document.getElementById('permanentAddress').value || 'Not provided';
    document.getElementById('reviewOfficeAddress').textContent = document.getElementById('officeAddress').value || 'Not provided';

    // Uploaded documents (this would need more complex logic in a real application)
    const documentList = document.getElementById('reviewDocuments');
    documentList.innerHTML = '';

    const documents = [
        'PAN Card',
        'Aadhar Card',
        'Income Tax Return',
        'Form 16',
        'Form 26AS',
        'Bank Statements',
        'Salary Slips',
        'Offer Letter'
    ];

    if (selectedEmploymentType !== 'salaried') {
        documents.push('GST Certificate');
    }

    documents.forEach(doc => {
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';
        listItem.innerHTML = `<i class="fas fa-file-pdf text-danger me-2"></i> ${doc}`;
        documentList.appendChild(listItem);
    });
}

// Form submission
function submitForm() {
    const termsAgree = document.getElementById('termsAgree');
    if (!termsAgree.checked) {
        alert('Please agree to the terms before submitting.');
        return;
    }

    // Prepare email parameters
    const templateParams = {
        to_email: 'autocred@easycred.co.in',
        from_name: document.getElementById('fullName').value,
        employment_type: selectedEmploymentType,
        full_name: document.getElementById('fullName').value,
        dob: document.getElementById('dob').value,
        father_name: document.getElementById('fatherName').value,
        mother_name: document.getElementById('motherName').value,
        pan_number: document.getElementById('panNumber').value,
        aadhar_number: document.getElementById('aadharNumber').value,
        current_address: document.getElementById('currentAddress').value,
        permanent_address: document.getElementById('permanentAddress').value,
        office_address: document.getElementById('officeAddress').value,
        // Note: In a real application, you would upload files to Cloudinary first
        // and then include the URLs in this email
    };

    // Send email using EmailJS
    emailjs.send('YOUR_EMAILJS_SERVICE_ID', 'YOUR_EMAILJS_TEMPLATE_ID', templateParams)
        .then(function(response) {
            alert('Your application has been submitted successfully! Our team will review your documents and get back to you shortly.');
            console.log('SUCCESS!', response.status, response.text);

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('documentModal'));
            modal.hide();

            // Reset form and go to first step
            document.querySelector('form').reset();
            showStep(1);
        }, function(error) {
            alert('There was an error submitting your application. Please try again or contact support.');
            console.log('FAILED...', error);
        });
}

// Toggle permanent address same as current
document.getElementById('sameAsCurrent').addEventListener('change', function() {
    if (this.checked) {
        document.getElementById('permanentAddress').value = document.getElementById('currentAddress').value;
        document.getElementById('permanentCity').value = document.getElementById('currentCity').value;
        document.getElementById('permanentState').value = document.getElementById('currentState').value;
        document.getElementById('permanentPincode').value = document.getElementById('currentPincode').value;
    } else {
        document.getElementById('permanentAddress').value = '';
        document.getElementById('permanentCity').value = '';
        document.getElementById('permanentState').value = '';
        document.getElementById('permanentPincode').value = '';
    }
});

// Initialize modal
const documentModal = document.getElementById('documentModal');
documentModal.addEventListener('shown.bs.modal', function() {
    // Reset form when modal is opened
    showStep(1);
    employmentTypes.forEach(t => t.classList.remove('selected'));
    document.querySelectorAll('.conditional-field').forEach(field => {
        field.classList.remove('show');
    });
    selectedEmploymentType = '';
});
</script>